<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atzuche.order.photo.mapper.OrderPhotoMapper">
	
	<select id="queryGetSrvCarList" resultType="com.atzuche.order.photo.entity.OrderPhotoEntity">
		SELECT id,photo_type photoType,path,user_type userType,order_no orderNo,create_time createTime,update_time updateTime,operator,serial_number as serialNumber FROM order_car_condition_photo
		where order_no=#{orderNo}
		<if test="type != null and type != ''">
			and photo_type=#{type}
		</if>

	</select>
	
	<select id="queryInsuranceClaimPhotoList" resultType="com.atzuche.order.photo.entity.OrderPhotoEntity">
		SELECT id,path,user_type userType,order_no orderNo,create_time createTime,update_time updateTime,operator FROM trans_claim_photo	where order_no=#{orderNo}
	</select>
	
	<select id="queryViolationPhotoList" resultType="com.atzuche.order.photo.entity.OrderPhotoEntity">
		SELECT id,path,user_type userType,order_no orderNo,create_time createTime,update_time updateTime,create_op as operator FROM renter_order_wz_illegal_photo where order_no=#{orderNo}
	</select>
	
	<insert id="addUploadOrderPhoto" parameterType="map">
		 INSERT INTO
		 <if test="photoType==1||photoType==2 || photoType==6 || photoType==7">
		  order_car_condition_photo(photo_type,path,user_type,order_no,serial_number,operator) VALUES(#{photoType},#{path},#{userType},#{orderNo},0,#{operator});
		 </if>
		 <if test="photoType==3">
		  trans_claim_photo(path,user_type,order_no,serial_number,operator) VALUES(#{path},#{userType},#{orderNo},0,#{operator});
		 </if>
		  <if test="photoType==4">
		  renter_order_wz_illegal_photo(path,user_type,order_no,serial_number,create_op, car_plate_num, update_op) VALUES(#{path},#{userType},#{orderNo},0,#{operator},#{carPlateNum},#{operator});
		 </if>
	</insert>


	<update id="updateUploadOrderPhoto" parameterType="map">
		update
		<if test="photoType==1||photoType==2 || photoType==6 || photoType==7">
			order_car_condition_photo set path = #{path}, operator = #{operator}, user_type = #{userType} where id = #{photoId};
		</if>
		<if test="photoType==3">
			trans_claim_photo set path = #{path}, operator = #{operator}, user_type = #{userType} where id = #{photoId};
		</if>
		<if test="photoType==4">
			renter_order_wz_illegal_photo set path = #{path}, create_op = #{operator},update_op = #{operator}, user_type = #{userType} where id = #{photoId};
		</if>
	</update>

	
	<delete id="delOrderPhoto">
		 DELETE FROM 
		 <if test="photoType==1||photoType==2">
		  order_car_condition_photo
		 </if>
		 <if test="photoType==3">
		  trans_claim_photo
		 </if>
		 <if test="photoType==4">
		  renter_order_wz_illegal_photo
		 </if>
		 WHERE id=#{id}
	</delete>
	<select id="queryWzcodeByOrderNo" resultType="java.lang.String">
		select wzcode from renyun_send_illegal_info_log
		where order_no=#{orderNo} order by id desc limit 1
	</select>
	<select id="queryIllegalPhotoByOrderNo" resultType="com.atzuche.order.photo.dto.PhotoPathDTO">
		select user_type userType,path img
		from renter_order_wz_illegal_photo
		where order_no=#{orderNo}
	</select>


	<select id="queryPhotoInfo" resultType="com.atzuche.order.photo.entity.OrderPhotoEntity">
		select order_no as orderNo, user_type as userType
		<if test="photoType==1||photoType==2 || photoType==6 || photoType==7">
			from order_car_condition_photo where id = #{photoId};
		</if>
		<if test="photoType==3">
			from trans_claim_photo where id = #{photoId};
		</if>
		<if test="photoType==4">
		    from renter_order_wz_illegal_photo where id = #{photoId};
		</if>
	</select>

	<insert id="addRenYunUploadOrderPhoto" parameterType="com.atzuche.order.photo.entity.OrderPhotoEntity">
		INSERT INTO
		order_car_condition_photo(photo_type,path,user_type,order_no,serial_number,operator)
        VALUES
        (#{photoType},#{path},#{userType},#{orderNo},#{serialNumber},#{operator})
	</insert>

	<select id="selectObjectByParams" parameterType="com.atzuche.order.photo.entity.OrderPhotoEntity" resultType="com.atzuche.order.photo.entity.OrderPhotoEntity">
		SELECT id,photo_type photoType,path,user_type userType,order_no orderNo,create_time createTime,update_time updateTime,operator,serial_number serialNumber FROM order_car_condition_photo
		where order_no=#{orderNo} and photo_type=#{photoType} and user_type = #{userType} and serial_number = #{serialNumber}
	</select>

	<update id="updateUploadRenYunOrderPhoto" parameterType="map">
		update
		order_car_condition_photo set path = #{path},user_type = #{userType},serial_number = #{serialNumber},operator = #{operator},photo_type = #{photoType} where id = #{photoId};
	</update>


</mapper>
